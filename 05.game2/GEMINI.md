# 2048 게임 개발 계획

이 문서는 Flutter를 사용하여 2048 게임을 개발하기 위한 규칙과 구현 계획을 정의합니다.

## 1. 게임 규칙 (Rules)

*   **목표**: 4x4 그리드에서 숫자 타일을 합쳐 '2048' 타일을 만드는 것이 최종 목표입니다.
*   **시작**: 게임은 2개의 타일(값은 2 또는 4)로 시작합니다.
*   **움직임**: 사용자는 상, 하, 좌, 우 방향으로 스와이프하여 그리드의 모든 타일을 해당 방향으로 끝까지 이동시킵니다.
*   **합치기**: 같은 숫자의 두 타일이 움직이다가 만나면, 두 숫자를 더한 하나의 타일로 합쳐집니다. (예: 8 + 8 = 16). 한 번의 움직임에서 합쳐져서 새로 생긴 타일은 다시 다른 타일과 합쳐지지 않습니다.
*   **새 타일 생성**: 유효한 움직임(보드에 변화가 생긴 경우)이 발생할 때마다, 비어있는 랜덤한 위치에 새로운 타일(90% 확률로 2, 10% 확률로 4)이 생성됩니다.
*   **점수**: 타일이 합쳐질 때마다 합쳐진 타일의 숫자만큼 점수가 올라갑니다.
*   **승리 조건**: '2048' 타일을 만들면 승리합니다. 승리 후에도 계속 플레이하여 더 높은 점수를 얻을 수 있습니다.
*   **패배 조건**: 그리드가 가득 차고, 더 이상 합칠 수 있는 타일(인접한 타일 중 같은 숫자가 없는 경우)이 없으면 게임이 종료됩니다.

## 2. 구현 계획 (Implementation Plan)

Flutter를 사용하여 2048 게임을 구현하며, 주요 관심사는 **게임 로직(Model)**, **UI(View)**, **상태 관리(State Management)** 입니다.

### 2.1. 프로젝트 구조 (Project Structure)

```
lib/
|-- main.dart           # 앱 시작점
|-- screens/
|   |-- game_screen.dart  # 메인 게임 화면 위젯
|-- widgets/
|   |-- tile_widget.dart  # 개별 타일 UI 위젯
|   |-- game_board.dart   # 게임 보드판 위젯
|-- logic/
|   |-- game_logic.dart   # 게임의 핵심 로직 (보드 관리, 이동, 점수 등)
|-- const/
|   |-- monsters.dart     # 몬스터 이름 및 타일 색상 등 상수 관리
|   |-- constants.dart    # 공통 상수 관리
|-- models/
|   |-- tile.dart         # Tile 데이터 모델
```

### 2.2. 게임 로직 (Game Logic - Model)

`lib/logic/game_logic.dart` 파일에 핵심 로직을 구현합니다.

*   **보드 표현**: `List<List<int>> board` (4x4 2차원 배열)를 사용하여 게임 보드를 표현합니다. 0은 빈 칸을 의미합니다.
*   **핵심 기능**:
    *   `initBoard()`: 보드를 0으로 초기화하고, 랜덤한 위치에 2개의 타일을 생성하여 게임을 시작합니다.
    *   `spawnNewTile()`: 비어있는 칸을 찾아 랜덤하게 2 또는 4를 추가합니다.
    *   `move(Direction direction)`: 상, 하, 좌, 우 이동을 처리하는 메인 함수입니다.
        *   **이동 알고리즘**: `moveLeft`를 기준으로 구현하고, 나머지 방향은 보드를 회전(transpose) 및 반전(reverse)시켜 `moveLeft`를 재사용하는 방식으로 구현합니다.
        *   **`moveLeft` 로직**:
            1.  0이 아닌 타일들을 왼쪽으로 압축합니다. `[0, 2, 2, 0]` -> `[2, 2]`
            2.  인접한 같은 숫자를 합칩니다. `[2, 2]` -> `[4]`
            3.  나머지 공간을 0으로 채웁니다. `[4]` -> `[4, 0, 0, 0]`
    *   `checkGameOver()`: 보드가 꽉 찼는지, 그리고 인접한 타일 중 합칠 수 있는 것이 있는지 확인합니다.
    *   `checkWinCondition()`: 보드에 2048 타일이 있는지 확인합니다.
    *   `score`: 현재 점수를 저장하고 관리합니다.

### 2.3. UI (View)

*   **`game_screen.dart`**:
    *   `StatefulWidget`으로 전체 게임 상태를 관리합니다.
    *   `GestureDetector`를 사용하여 사용자의 스와이프 입력을 감지하고 `game_logic`의 `move()` 함수를 호출합니다.
    *   점수, '새 게임' 버튼, 게임 오버/승리 메시지를 표시합니다.
*   **`game_board.dart`**:
    *   `GridView.builder`를 사용하여 4x4 그리드를 생성합니다.
    *   `game_logic`의 `board` 데이터를 기반으로 각 셀에 `tile_widget`을 렌더링합니다.
    *   타일이 움직이고 합쳐질 때 부드러운 애니메이션 효과(`AnimatedPositioned`, `AnimatedOpacity` 등)를 추가하여 사용자 경험을 향상시킵니다.
*   **`tile_widget.dart`**:
    *   타일의 숫자 값을 받아 `Container`에 표시합니다.
    *   숫자 값에 따라 다른 색상과 텍스트 스타일을 적용합니다. (예: 2는 밝은 회색, 4는 연한 노란색, 8은 주황색 등)

### 2.4. 상태 관리 (State Management)

*   초기에는 `StatefulWidget`의 `setState()`를 사용하여 UI를 갱신합니다.
*   게임 로직이 복잡해지거나 기능이 확장될 경우, Provider나 Riverpod 같은 상태 관리 라이브러리 도입을 고려할 수 있으나, 이 게임의 규모에서는 `setState`만으로도 충분합니다.

## 3. 개발 단계 (Development Steps)

1.  **프로젝트 설정 및 기본 구조 생성**: 위에 정의된 프로젝트 구조대로 파일과 폴더를 생성합니다.
2.  **데이터 구조 및 핵심 로직 구현**: `game_logic.dart`에 보드 데이터 구조와 `initBoard`, `spawnNewTile` 함수를 구현합니다.
3.  **기본 UI 렌더링**: `game_board.dart`에서 `GridView`를 사용하여 초기 보드 상태를 화면에 표시합니다. `tile_widget`으로 각 타일의 스타일을 정의합니다.
4.  **이동 및 합치기 로직 구현**: `move` 함수와 네 방향의 이동/합치기 알고리즘을 구현합니다.
5.  **사용자 입력 처리**: `GestureDetector`를 `game_screen.dart`에 추가하여 스와이프 제스처를 감지하고, `move` 함수를 호출한 뒤 `setState`로 UI를 업데이트합니다.
6.  **게임 상태 관리**: 점수 계산, 게임 오버 및 승리 조건을 확인하고 UI에 피드백(다이얼로그 등)을 제공하는 로직을 추가합니다.
7.  **UI 개선 및 애니메이션**: 타일의 색상, 폰트 등 디자인을 다듬고, 타일이 생성되고 움직일 때 자연스러운 애니메이션을 추가하여 완성도를 높입니다.

## 4. 진행 상황 및 향후 고려사항

### 4.1. 현재까지 진행된 작업

*   **프로젝트 구조 생성**: `lib/screens`, `lib/widgets`, `lib/logic`, `lib/const` 디렉토리를 생성했습니다.
*   **기본 파일 생성 및 초기 코드 작성**: `main.dart`, `screens/game_screen.dart`, `widgets/tile_widget.dart`, `widgets/game_board.dart`, `logic/game_logic.dart`, `const/colors.dart` 파일들을 생성하고 기본적인 코드를 작성했습니다.
*   **핵심 게임 로직 구현**: `logic/game_logic.dart`에 보드 초기화, 타일 생성, 이동(상,하,좌,우), 합치기, 게임 오버/승리 조건 확인 등의 핵심 로직을 구현했습니다.
    *   `DragEndDetails`의 `primaryVelocity` 오류를 `details.velocity.pixelsPerSecond`를 사용하여 수정했습니다.
    *   타일 슬라이딩 및 합치기 로직을 `_compress`, `_merge`, `_pad` 함수를 `_slideAndMergeRow` 단일 함수로 리팩토링하여 개선했습니다.
*   **UI 컴포넌트 구현**: `widgets/tile_widget.dart`와 `widgets/game_board.dart`를 통해 타일과 게임 보드의 UI를 구현했습니다.
*   **UI와 로직 통합**: `screens/game_screen.dart`에서 `GameLogic` 인스턴스를 관리하고, `GestureDetector`를 통해 사용자 스와이프 입력을 받아 게임 로직을 호출하며, `setState`를 통해 UI를 업데이트하도록 연결했습니다.
    *   게임 보드 오른쪽에 상/하/좌/우 화살표 버튼을 배치하여 수동 조작이 가능하도록 UI를 개선했습니다.
    *   `Expanded` 위젯과 `LayoutBuilder`를 사용하여 4x4 게임 보드가 화면에 완전히 표시되도록 UI 스케일링 문제를 해결했습니다.
*   **프로젝트 초기화 문제 해결**: `pubspec.yaml` 파일이 없어 `flutter run`이 실패했던 문제를 해결하기 위해 `pubspec.yaml` 파일을 직접 생성하고 `flutter pub get`을 실행하여 의존성을 설치했습니다. 또한, `flutter create .` 명령어를 통해 Windows 데스크톱 빌드 지원을 추가했습니다.
*   **몬스터 출현 타이밍 수정**: 타일 이동 애니메이션이 완료된 후 새로운 타일이 생성되도록 `game_logic.dart`에서 `spawnNewTile()` 호출을 제거하고, `game_screen.dart`에서 애니메이션 지연 후 호출하도록 수정했습니다.
*   **타일 표시 방식 변경 (텍스트 -> 이미지)**: `lib/widgets/tile_widget.dart`를 수정하여 몬스터 이름 텍스트 대신 준비된 몬스터 이미지를 타일에 표시하도록 변경했습니다.
    *   `assets/images` 폴더에 이미지 파일을 추가하고 `pubspec.yaml`에 에셋으로 등록했습니다.
    *   `lib/const/monsters.dart`에 이미지 파일 경로를 매핑하는 `monsterImagePaths` 상수를 추가했습니다.
    *   이미지가 없는 타일의 경우, 기존처럼 텍스트(몬스터 이름)가 표시되도록 예외 처리했습니다.

### 4.2. 앞으로의 작업 계획

*   **애플리케이션 실행 및 최종 테스트**: `flutter run` 명령어를 사용하여 현재까지 구현된 모든 기능(특히 몬스터 이미지 표시)이 정상적으로 동작하는지 최종적으로 확인하고 테스트합니다.
*   **애니메이션 및 시각 효과 강화**: 몬스터가 합쳐지며 진화할 때 더 실감 나는 애니메이션 효과(예: 반짝임, 크기 변화)를 추가하여 시각적 만족도를 높입니다.
*   **UI/UX 디자인 통일성 강화**: 게임의 전반적인 디자인(배경, 점수판, 버튼 등)을 몬스터 테마에 맞게 개선하여 통일감 있고 몰입감 있는 사용자 경험을 제공합니다.
*   **사운드 이펙트 추가 (선택 사항)**: 타일 이동, 합치기, 게임 오버 등 주요 이벤트에 간단한 사운드 이펙트를 추가하여 게임의 생동감을 더합니다.
*   **코드 최종 검토**: 전체 코드를 다시 한번 검토하고, 불필요한 코드를 제거하거나 구조를 개선하여 안정성과 유지보수성을 높입니다.

### 4.3. 몬스터 테마 적용 (Monster Theme Application)

2048 게임의 숫자 타일을 판타지 세계의 괴물로 대체하여 게임의 몰입감과 시각적 재미를 높입니다.

#### 4.3.1. 몬스터 진화 단계 (Monster Progression)

숫자 값에 따라 다음과 같은 몬스터 진화 단계를 제안합니다. (예시는 변경 가능)

*   **2**: 슬라임 (Slime)
*   **4**: 고블린 (Goblin)
*   **8**: 오크 (Orc)
*   **16**: 트롤 (Troll)
*   **32**: 오우거 (Ogre)
*   **64**: 미노타우로스 (Minotaur)
*   **128**: 새끼 드래곤 (Dragon Whelp)
*   **256**: 와이번 (Wyvern)
*   **512**: 히드라 (Hydra)
*   **1024**: 고대 드래곤 (Ancient Dragon)
*   **2048**: 엘더 갓 (Elder God) 또는 최종 보스급 몬스터

#### 4.3.2. 구현 계획

1.  **몬스터 데이터 정의**:
    *   `lib/const/monsters.dart` 파일을 새로 생성하거나 `lib/const/colors.dart`에 확장하여, 각 숫자 값에 해당하는 몬스터 이름과 (선택적으로) 해당 몬스터의 이미지 경로 또는 색상 정보를 매핑하는 `Map` 또는 `Enum`을 정의합니다.
    *   예시: `Map<int, String> monsterNames = {2: 'Slime', 4: 'Goblin', ...};`
    *   각 몬스터 타일의 배경색도 이 파일에서 관리하여 시각적으로 구분되도록 합니다.

2.  **`tile_widget.dart` 수정**:
    *   현재 숫자를 표시하는 부분을 수정하여, 타일의 `value`에 따라 위에서 정의한 `monsterNames` 맵을 참조하여 해당 몬스터의 이름을 텍스트로 표시합니다.
    *   **초기 구현**: 텍스트로 몬스터 이름을 표시하여 기능 구현을 우선합니다.
    *   **향후 개선**: 각 몬스터에 해당하는 이미지 에셋을 준비하여 텍스트 대신 이미지를 표시하도록 `Image.asset()` 위젯을 활용합니다. (예: `assets/images/slime.png`, `assets/images/goblin.png` 등) 이미지 에셋은 `pubspec.yaml`에 등록해야 합니다. **(현재 이미지 에셋은 사용자 준비 필요)**

3.  **`game_logic.dart` 유지**:
    *   게임의 핵심 로직(`game_logic.dart`)은 숫자를 기반으로 한 이동 및 합치기 연산을 그대로 유지합니다. 몬스터 테마는 순전히 UI/표시 계층에서만 처리됩니다. 즉, `game_logic`은 여전히 2, 4, 8 등의 숫자 값을 다룹니다.

4.  **UI/UX 개선**:
    *   몬스터 테마에 어울리는 폰트나 전반적인 게임 화면의 디자인을 고려하여 사용자 경험을 향상시킵니다.
    *   몬스터가 합쳐질 때의 애니메이션 효과를 더욱 강화하여 진화하는 느낌을 줄 수 있습니다.

#### 4.3.3. 개발 단계

1.  `lib/const/monsters.dart` 파일 생성 및 몬스터 이름/색상 매핑 정의.
2.  `lib/widgets/tile_widget.dart`에서 숫자 대신 몬스터 이름(텍스트)을 표시하도록 수정.
3.  각 몬스터 타일에 맞는 배경색 적용.
4.  (선택 사항) 몬스터 이미지 에셋 준비 및 `pubspec.yaml`에 등록.
5.  (선택 사항) `tile_widget.dart`에서 텍스트 대신 몬스터 이미지 표시하도록 수정.
6.  전반적인 UI/UX 디자인 개선.